We're proud to announce the new feature release of darktable, 5.4.0!

The github release is here: [https://github.com/darktable-org/darktable/releases/tag/release-5.4.0](https://github.com/darktable-org/darktable/releases/tag/release-5.4.0).

To build from source, do not use the autogenerated tarball provided by GitHub on the release page, download our tar.xz file instead. If you're just building for yourself without creating a package for some distribution, then using source code cloning in git is an even more convenient way.

The checksums are:

```
$ sha256sum darktable-5.4.0.tar.xz
??? darktable-5.4.0.tar.xz

$ sha256sum darktable-5.4.0-x86_64.dmg
??? darktable-5.4.0-x86_64.dmg

$ sha256sum darktable-5.4.0-arm64.dmg
??? darktable-5.4.0-arm64.dmg

$ sha256sum darktable-5.4.0-arm64-13.5.dmg
??? darktable-5.4.0-arm64-13.5.dmg

$ sha256sum darktable-5.4.0-win64.exe
??? darktable-5.4.0-win64.exe

$ sha256sum darktable-4.8.1-x86_64.AppImage
???  darktable-5.4.0-x86_64.AppImage
```

When updating from the stable 5.0 series, please bear in mind that your edits will be preserved during this process, but the new library and configuration will no longer be usable with 5.0.

You are strongly advised to take a backup first.

#### Important note: to make sure that darktable can keep on supporting the raw file format for your camera, *please* read [this post](https://discuss.pixls.us/t/raw-samples-wanted/5420?u=lebedevri) on how/what raw samples you can contribute to ensure that we have the *full* raw sample set for your camera under CC0 license!

Since darktable 5.2:

- ??? commits to darktable+rawspeed
- ??? pull requests handled
- ??? issues closed

_Please note that the darktable documentation is not currently complete for release 5.4
and contributions are greatly appreciated. Please see the
[project documentation](https://github.com/darktable-org/dtdocs#contributing)
for more information on how to contribute._

## The Big Ones

The following is a summary of the main features added to darktable
5.4. Please see the user manual for more details of the individual
changes (where available).

- A new section Capture Sharpening is added into the demosaic
  module. The capture sharpening tries to recover details lost due to
  in-camera blurring, which can be caused by diffraction, the
  anti-aliasing filter or other sources of Gaussian-type blur.

- Added a new tone mapper implementation based on Blender's AgX
  display transform. The new module's color output is similar to that
  of Sigmoid, but the provided set of controls is more extensive. It
  allows for setting exposure white and black points explicitly,
  similar to Filmic RGB. The implementation includes a user-adjustable
  pivot point for the tone curve, with the default set at 18%
  mid-gray. Contrast around this pivot is adjustable. Controls are
  provided to create a section of constant contrast, and independent
  sliders are available to control the contrast in shadows and
  highlights (the "toe" and "shoulder" of the curve). The resulting
  output is characterized by a gradual color desaturation in
  highlights, similar to film, and a natural-looking color
  representation in mid-tones and highlights.

## UI/UX Improvements

- Show a busy cursor when changing views. This provides immediate
  feedback when, for example, double-clicking an image in the
  lighttable instead of simply freezing the UI until the darkroom has
  finished opening.

- Added the standard "Window" menu to the application menu bar on
  macOS.

- Moved controls for mask exposure and contrast compensation to the
  advanced tab.

- In the navigation windows, the zoom is now better behaving. After a
  free zoom over the darkroom, using the scroll over the zoom level
  indicator of the navigation window, the selected zoom will be the
  closest match (above or below depending on the scroll
  direction). This is better as previous behavior where the zoom level
  was always set to "small".

- When moving around in a (zoomed) center view in the darkroom, we now
  pre-calculate a slightly larger area so that it might not always be
  necessary to immediately recalculate after further moves. The
  initial 1px mouse move is generally not final, after all. This does
  mean longer calculation times, so you can switch this off by setting
  darkroom/ui/anticipate_move in darktablerc to 1.0. If you use cursor
  keys to move around, you might want to increase it to >1.4 to
  anticipate at least one further 20% move on either side. When the
  recalculation is triggered by a module parameter change, say
  exposure increase, only the exact area shown is calculated as
  before, for optimal responsiveness.

- The popup (that you get when right-clicking) for sliders with a 360Â°
  range now shows a color wheel or compass. If the slider is
  soft-limited to a smaller range (for example in rotate&perspective)
  you can toggle zooming out to the full range by
  middle-clicking. Another middle click will restore the soft range
  (and the normal fine-tuning mechanism).

- To make the rotation in the wheel match the rotation effect in the
  image, most slider directions for angles have been reversed. You may
  want to add a "-1" speed to any shortcuts you have gotten used to.

- Added new default shortcut keys. These will take effect only if the
  keys do not yet have user-defined assignments.

  - <kbd>c</kbd> - toggle crop box.

  - <kbd>e</kbd> - set exposure compensation (equivalent to
    right-clicking on the exposure slider).

  - <kbd>alt-r</kbd> - set image rotation (equivalent to
    right-clicking on the rotation slider).

  - <kbd>alt-[ and alt- ]</kbd> - fine rotation adjustment.

- Different shapes for the indicator on sliders can now be selected in
  preferences/misc/interface (triangle, circle, diamond, bar).

- All toolbar buttons on the lighttable and darkroom have their
  enabled state recovered across sessions. The visibility of the
  enabled buttons has been improved to avoid confusions when
  restarting Darktable and seeing artifacts due to some tools being
  activate like Gamut check.

## Performance Improvements

- Tune performance for the Lut3D module (5% to 20% speed-up).

## Other Changes

- Allow using <kbd>Shift</kbd> modifier to select only the feather
  points on blend masks. This is sometime needed when the path point
  and the feather point are too close to each others.

- Hierarchical presets are now supported for utility modules as well
  as processing modules.

- Dual demosaicing now works also in tiling mode for possibly better
  OpenCL performance and smaller CPU memory pressure.

- Added automatic compensation of camera's hidden underexposure for
  Canon Lighting Optimizer mode, Nikon Active D-Lighting and HLG tone
  modes, Olympus Gradation mode, Pentax Dynamic Range Expansion mode,
  and Fujifilm DR200/DR400 modes.

- Add a RGB percent display in the color picker module.

- Allow far smaller crop to be created (up to 99% of the image size).

## Bug Fixes

- Fixed some issues with the hierarchical styles handling in the
  styles module.

- Fixed moving additional extra audio or text sidecar files when
  an image is moved.

- Fixed module based collection restoring. After quitting darktable with a
  module based collection, the lighttable was empty after restarting it.

- Fixed some reset issues of the export module. The format and storage
  sections were not reset properly.

- Fixed corruption of sidecars during large imports of images with XMP
  sidecars.

- Fixed a bug where changing the image scaling in the export module
  influences the result of a running export job.

- Make sure we always fill the complete main darkroom canvas while
  zooming at large scales.

- Make sure image changed_timestamp is updated when a sidecar file
  is applied.

- Fixed drag and drop of images on the map gives wrong location
  assignment on macOS.

- Fixed auto applied presets for sraws and true monochromes.

- Fixed a bug in details threshold mask for monochrome raw files
  leading to crashes.

- Fixed an issue when positioning the main darkroom windows due to
  precision in computation. The precision is now to the pixel and
  avoid a displacement in some cases.

- Fixed issue in darktable-cli that prevented input files from being detected.

- Fixed out of memory issue which could kill Darktable on small
  systems when processing large images.

- Allow the variable `$(ROLL.NAME)` to have optional levels, `$(ROLL.NAME[n])`,
  where 1 <= n <= 5, the levels follow the same rules as film roll, the default
  value `n=1`, this keep the previous behavior of `$(ROLL.NAME)`.

## Lua

### API Version

- API version is now 9.6.0

### New Features

- Added darktable.query_event() to check if an event is registered.

- Added collection-changed event that fires when the collection changes.

- Added darktable.configuration.share_dir and darktable.configuration.data_dir
  to expose the darktable data and share directories.

### Bug Fixes

- Check added to ensure view has changed before processing GUI events
  preventing hang on start.

- return an empty table (nil) for a non-existent tag accessed by index

- return an empty table (nil) when a tag contains no images with the tag

- Ensure translations are displayed in UTF-8 under Windows


### Add action support for Lua

### Other Lua changes

- N/A

## Notes

- When exporting to AVIF, EXR, JPEG XL, or XCF, selecting specific
  metadata (e.g. geo-tag or creator) is not currently possible. For
  AVIF, EXR, JPEG XL, and XCF formats, darktable will not include any
  metadata fields unless the user selects all of the checkboxes in the
  export module's preference options.

- Starting with release 5.4, Intel Macs and macOS versions older than 14.0
  are no longer supported.

## Changed Dependencies

### Mandatory

- N/A

### Optional

- N/A

## RawSpeed changes

- OM System 14-bit high-resolution ORFs are now supported.
- Canon EOS 5D Mark II crop was updated.
- Fujifilm FinePix X100 crop was updated.
- Samsung EX1 crop and white level were updated.
- Sony ILCE-1M2 color matrix was updated.

## Camera support, compared to 5.0

### Base Support

- Canon EOS R5 C (requires LibRaw 202502 and later)
- Fujifilm GFX100RF (compressed)
- Fujifilm GFX100S II (compressed)
- Nikon 1 J5
- Nikon 1 V3
- Nikon COOLPIX P1100 (12bit-uncompressed)
- Nikon Coolpix P340
- Nikon D100
- Nikon D200
- Nikon D2Hs
- Nikon D2X
- Nikon D3300
- Nikon D3X
- Nikon D40
- Nikon D40X
- Nikon D5
- Nikon D5000
- Nikon D5300
- Nikon D5500
- Nikon D5600
- Nikon D60
- Nikon D80
- Nikon D800
- Nikon D800E
- Nikon D90
- Nikon Z5_2 (14bit-compressed)
- OM System OM-3
- Olympus SP510UZ
- Panasonic DC-G97 (4:3)
- Panasonic DC-G9M2 (4:3)
- Panasonic DC-GH6 (4:3)
- Panasonic DC-S1RM2 (3:2)
- Panasonic DC-S5M2 (3:2)
- Panasonic DC-S5M2X (3:2)
- Panasonic DC-S9 (3:2)
- Panasonic DC-TZ99 (4:3)
- Panasonic DC-ZS99 (4:3)
- Phase One IQ150
- Phase One P40+
- Samsung GX20
- Sigma BF (DNG)
- Sigma DP1 (DNG)
- Sigma DP1 Merrill (DNG)
- Sinar Hy6 (DNG)
- Sony DSC-RX100M7A
- Sony ILCE-6100A
- Sony ILCE-6400A
- Sony ILME-FX3A
- Sony ZV-1A
- Sony ZV-E10M2

### White Balance Presets

- Fujifilm GFX100 II
- OM System OM-3
- Panasonic DC-S9

### Noise Profiles

- Fujifilm GFX 100
- Leica SL2
- OM System OM-3
- Panasonic DC-S1RM2
- Panasonic DC-S9
- Sony ILCE-1M2

### Missing Compression Mode Support

- Apple ProRAW DNGs
- CinemaDNG lossless (Blackmagic, some DJI, etc.) and lossy (Blackmagic)
- DNG 1.7 using JPEG XL (Adobe enhanced, Samsung Expert RAW)
- Fujifilm lossy RAFs
- Nikon high efficiency NEFs
- Phase One other than IIQ L
- Sony downsized lossless ARWs ("M" for full-frame, "S" for full-frame & APS-C)

### Suspended Support

Support for the following cameras is suspended because no samples are available on https://raw.pixls.us:

- Creo/Leaf Aptus 22(LF3779)/Hasselblad H1
- Fujifilm IS-1
- Kodak EasyShare Z980
- Leaf Aptus-II 5(LI300059)/Mamiya 645 AFD
- Leaf Credo 60
- Leaf Credo 80
- Olympus SP320
- Phase One IQ250
- ST Micro STV680

## Translations

- ???
